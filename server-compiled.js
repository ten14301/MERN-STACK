(()=>{var e={911:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var a=n(689),r=n.n(a);const s=require("axios");var o=n.n(s);const i=function(e){const[t,n]=(0,a.useState)(!1),[s,i]=(0,a.useState)(""),[l,c]=(0,a.useState)(),[d,u]=(0,a.useState)(""),[p,m]=(0,a.useState)(e.Pass||"");return r().createElement("div",{className:"card"},t&&r().createElement("div",null,r().createElement("div",null,r().createElement("input",{onChange:e=>c(e.target.files[0]),className:"form-control form-control-sm",type:"file"}))),r().createElement("img",{src:e.photo?`/upload-img/${e.photo}`:"/no-image.jpg",className:"card-img-top",alt:`${e.Role} named ${e.Username}`}),r().createElement("div",null,!t&&r().createElement(r().Fragment,null,r().createElement("p",null,e.Username),r().createElement("p",null,e.Role),!e.readOnly&&r().createElement("div",null,r().createElement("button",{onClick:()=>{n(!0),i(e.Username),u(e.Role),m(e.Pass||""),c("")}},"Edit")," ",r().createElement("button",{onClick:async()=>{o().delete(`/user/${e.id}`),e.setUsers((t=>t.filter((t=>t._id!==e.id))))}},"Delete"))),t&&r().createElement("form",{onSubmit:async function(t){t.preventDefault(),n(!1),e.setUsers((t=>t.map((function(t){return t._id===e.id?{...t,Username:s,Role:d,Pass:p}:t}))));const a=new FormData;l&&a.append("photo",l),a.append("_id",e.id),a.append("Username",s),a.append("Role",d),a.append("Pass",p);const r=await o().post("/update-user",a,{headers:{"Content-Type":"multipart/form-data"}});r.data&&e.setUsers((t=>t.map((function(t){return t._id===e.id?{...t,photo:r.data}:t}))))}},r().createElement("div",null,r().createElement("input",{autoFocus:!0,onChange:e=>i(e.target.value),type:"text",value:s})),r().createElement("div",null,r().createElement("input",{onChange:e=>u(e.target.value),type:"text",value:d})),r().createElement("div",null,r().createElement("input",{onChange:e=>m(e.target.value),type:"text",value:p})),r().createElement("div",null,r().createElement("button",null,"Save")," ",r().createElement("button",{onClick:()=>n(!1)},"Cancel")))))}},860:e=>{"use strict";e.exports=require("express")},470:e=>{"use strict";e.exports=require("fs-extra")},13:e=>{"use strict";e.exports=require("mongodb")},738:e=>{"use strict";e.exports=require("multer")},689:e=>{"use strict";e.exports=require("react")},684:e=>{"use strict";e.exports=require("react-dom/server")},109:e=>{"use strict";e.exports=require("sanitize-html")},441:e=>{"use strict";e.exports=require("sharp")},17:e=>{"use strict";e.exports=require("path")}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=n(860),{MongoClient:t,ObjectId:a}=n(13),r=n(738),s=n(109),o=n(470),i=n(441),l=n(17),c=n(689),d=n(684),u=n(911).Z,p=e();let m;const f=r();function g(e,t,n){"string"!=typeof e.body.Username&&(e.body.Username=""),"string"!=typeof e.body.Role&&(e.body.Role=""),"string"!=typeof e.body.Pass&&(e.body.Pass=""),"string"!=typeof e.body._id&&(e.body._id=""),e.cleanData={Username:s(e.body.Username.trim(),{allowedTags:[],allowedAttributes:{}}),Pass:s(e.body.Pass.trim(),{allowedTags:[],allowedAttributes:{}}),Role:s(e.body.Role.trim(),{allowedTags:[],allowedAttributes:{}})},n()}o.ensureDirSync(l.join("public","upload-img")),p.set("view engine","ejs"),p.set("views","./views"),p.use(e.static("public")),p.use(e.json()),p.use(e.urlencoded({extended:!1})),p.get("/",(async(e,t)=>{const n=await m.collection("User").find().toArray(),a=d.renderToString(c.createElement("div",{className:"container"},c.createElement("div",{className:"user-grid"},n.map((e=>c.createElement(u,{key:e._id,name:e.Username,Role:e.Role,photo:e.photo,id:e._id,readOnly:!0}))))));t.render("home",{generateHTML:a})})),p.use((function(e,t,n){const a=e.headers.authorization;if(a){const e=a.split(" ")[1],r=Buffer.from(e,"base64").toString("utf-8"),[s,o]=r.split(":");m.collection("User").findOne({Username:s,Pass:o}).then((e=>{e&&"Admin"==e.Role?n():(console.log(a),t.status(401).send("Try again"))})).catch((e=>{console.log(e),t.status(500).send("Internal Server Error")}))}else t.set("WWW-Authenticate","Basic realm='MERN'"),t.status(401).send("Authorization required")})),p.delete("/user/:id",(async(e,t)=>{"string"!=typeof e.params.id&&(e.params.id="");const n=await m.collection("User").findOne({_id:new a(e.params.id)});n.photo&&o.remove(l.join("public","upload-img",n.photo)),m.collection("User").deleteOne({_id:new a(e.params.id)}),t.send("Deleted")})),p.post("/update-user",f.single("photo"),g,(async(e,t)=>{if(e.file){const n=`${Date.now()}.jpg`;await i(e.file.buffer).resize(170,170).jpeg({quality:60}).toFile(l.join("public","upload-img",n)),e.cleanData.photo=n;const r=await m.collection("User").findOneAndUpdate({_id:new a(e.body._id)},{$set:e.cleanData});r.value.photo&&o.remove(l.join("public","upload-img",r.value.photo)),t.send(n)}else m.collection("User").findOneAndUpdate({_id:new a(e.body._id)},{$set:e.cleanData}),t.send(!1)})),p.get("/api/users",(async(e,t)=>{const n=await m.collection("User").find().toArray();t.json(n)})),p.post("/create-user",f.single("photo"),g,(async(e,t)=>{if(await m.collection("User").findOne({Username:e.cleanData.Username}))return t.status(400).send("Username already exists");{if(e.file){const t=`${Date.now()}.jpg`;await i(e.file.buffer).resize(170,170).jpeg({quality:60}).toFile(l.join("public","upload-img",t)),e.cleanData.photo=t}console.log(e.body);const n=await m.collection("User").insertOne(e.cleanData),r=await m.collection("User").findOne({_id:new a(n.insertedId)});t.send(r)}})),p.get("/admin",((e,t)=>{t.render("admin")})),async function(){const e=new t("mongodb://admin:admin@localhost:27017/Mern?&authSource=admin");await e.connect(),m=e.db(),p.listen(3e3)}()})()})();