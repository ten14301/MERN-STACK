(()=>{var e={860:e=>{"use strict";e.exports=require("express")},470:e=>{"use strict";e.exports=require("fs-extra")},13:e=>{"use strict";e.exports=require("mongodb")},738:e=>{"use strict";e.exports=require("multer")},109:e=>{"use strict";e.exports=require("sanitize-html")},441:e=>{"use strict";e.exports=require("sharp")},17:e=>{"use strict";e.exports=require("path")}},t={};function s(o){var r=t[o];if(void 0!==r)return r.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,s),n.exports}(()=>{const e=s(860),{MongoClient:t,ObjectId:o}=s(13),r=s(738),n=s(109),i=s(470),a=s(441),l=s(17),c=e();let d;const u=r();i.ensureDirSync(l.join("public","upload-img")),c.set("view engine","ejs"),c.set("views","./views"),c.use(e.static("public")),c.use(e.json()),c.use(e.urlencoded({extended:!1})),c.get("/",(async(e,t)=>{const s=await d.collection("User").find().toArray();t.render("home",{allusers:s})})),c.use((function(e,t,s){const o=e.headers.authorization;if(o){const e=o.split(" ")[1],r=Buffer.from(e,"base64").toString("utf-8"),[n,i]=r.split(":");d.collection("User").findOne({Username:n,Pass:i}).then((e=>{e?s():(console.log(o),t.status(401).send("Try again"))})).catch((e=>{console.log(e),t.status(500).send("Internal Server Error")}))}else t.set("WWW-Authenticate","Basic realm='MERN'"),t.status(401).send("Authorization required")})),c.get("/api/users",(async(e,t)=>{const s=await d.collection("User").find().toArray();t.json(s)})),c.post("/create-user",u.single("photo"),(function(e,t,s){"string"!=typeof e.body.Username&&(e.body.Username=""),"string"!=typeof e.body.Role&&(e.body.Role=""),"string"!=typeof e.body.Pass&&(e.body.Pass=""),"string"!=typeof e.body._id&&(e.body._id=""),e.cleanData={Username:n(e.body.Username.trim(),{allowedTags:[],allowedAttributes:{}}),Pass:n(e.body.Pass.trim(),{allowedTags:[],allowedAttributes:{}}),Role:n(e.body.Role.trim(),{allowedTags:[],allowedAttributes:{}})},s()}),(async(e,t)=>{if(e.file){const t=`${Date.now()}.jpg`;await a(e.file.buffer).resize(844,456).jpeg({quality:60}).toFile(l.join("public","upload-image",t)),e.cleanData.photo=t}console.log(e.body);const s=await d.collection("User").insertOne(e.cleanData),r=await d.collection("User").findOne({_id:new o(s.insertedId)});t.send(r)})),c.get("/admin",((e,t)=>{t.render("admin")})),async function(){const e=new t("mongodb://admin:admin@localhost:27017/Mern?&authSource=admin");await e.connect(),d=e.db(),c.listen(3e3)}()})()})();