(()=>{var e={911:(e,t,a)=>{"use strict";a.d(t,{Z:()=>l});var n=a(689),r=a.n(n);const s=require("axios");var o=a.n(s);const l=function(e){const[t,a]=(0,n.useState)(!1),[s,l]=(0,n.useState)(!1),[i,c]=(0,n.useState)(""),[d,m]=(0,n.useState)(""),[u,p]=(0,n.useState)(),[f,g]=(0,n.useState)(""),[b,y]=(0,n.useState)(e.Pass||"");const E=()=>r().createElement("thead",null,r().createElement("tr",null,r().createElement("td",null,"Img"),r().createElement("td",null,"Role"),r().createElement("td",null,"Team"),r().createElement("td",null,"Action")));return r().createElement("table",{className:"board",width:"100%"},r().createElement(E,null),r().createElement("tbody",null,r().createElement("tr",null,r().createElement("td",{className:"people"},r().createElement("img",{src:e.photo?`/upload-img/${e.photo}`:"/no-image.jpg",className:"card-img-top",alt:`${e.Role} named ${e.Username}`}),r().createElement("div",{className:"people-de"},r().createElement("h5",null,e.Username))),r().createElement("td",{className:"Role"},r().createElement("p",null,e.Role)),r().createElement("td",{className:"peple-team"},r().createElement("p",null,e.Team)),!e.readOnly&&r().createElement("td",{className:"Action"},r().createElement("button",{onClick:()=>{l(!0),c(e.Username),g(e.Role),m(e.Team),y(e.Pass||""),p("")}},"Edit")," ",r().createElement("button",{onClick:async()=>{await o().delete(`/user/${e.id}`),e.setUsers((t=>t.filter((t=>t._id!==e.id))))}},"Delete"))),s&&r().createElement("div",{className:"popup"},r().createElement("div",{className:"popup-content"},r().createElement("div",{className:"popup-inner"},r().createElement("form",{onSubmit:async function(t){t.preventDefault(),l(!1),e.setUsers((t=>t.map((function(t){return t._id===e.id?{...t,Username:i,Role:f,Team:d,Pass:b}:t}))));const a=new FormData;u&&a.append("photo",u),a.append("_id",e.id),a.append("Username",i),a.append("Role",f),a.append("Team",d),a.append("Pass",b);const n=await o().post("/update-user",a,{headers:{"Content-Type":"multipart/form-data"}});n.data&&e.setUsers((t=>t.map((function(t){return t._id===e.id?{...t,photo:n.data}:t}))))}},r().createElement("div",{className:"form-group-horizontal"},r().createElement("div",{className:"form-group"},r().createElement("label",null,"Username:"),r().createElement("input",{autoFocus:!0,className:"form-control",onChange:e=>c(e.target.value),type:"text",value:i})),r().createElement("div",{className:"form-group"},r().createElement("label",null,"Role:"),r().createElement("input",{className:"form-control",onChange:e=>g(e.target.value),type:"text",value:f}))),r().createElement("div",{className:"form-group"},r().createElement("label",null,"Team:"),r().createElement("input",{className:"form-control",onChange:e=>m(e.target.value),type:"text",value:d})),r().createElement("div",{className:"form-group"},r().createElement("label",null,"Password:"),r().createElement("input",{className:"form-control",onChange:e=>y(e.target.value),type:"password",value:b})),r().createElement("div",{className:"form-group"},r().createElement("button",{type:"submit",className:"btn btn-primary"},"Save")," ",r().createElement("button",{className:"btn btn-secondary",onClick:()=>l(!1)},"Cancel"))))))))}},860:e=>{"use strict";e.exports=require("express")},470:e=>{"use strict";e.exports=require("fs-extra")},13:e=>{"use strict";e.exports=require("mongodb")},738:e=>{"use strict";e.exports=require("multer")},689:e=>{"use strict";e.exports=require("react")},684:e=>{"use strict";e.exports=require("react-dom/server")},109:e=>{"use strict";e.exports=require("sanitize-html")},441:e=>{"use strict";e.exports=require("sharp")},17:e=>{"use strict";e.exports=require("path")}},t={};function a(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,a),s.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=a(860),{MongoClient:t,ObjectId:n}=a(13),r=a(738),s=a(109),o=a(470),l=a(441),i=a(17),c=a(689),d=a(684),m=a(911).Z,u=e();let p;const f=r();function g(e,t,a){"string"!=typeof e.body.Username&&(e.body.Username=""),"string"!=typeof e.body.Role&&(e.body.Role=""),"string"!=typeof e.body.Team&&(e.body.Team=""),"string"!=typeof e.body.Pass&&(e.body.Pass=""),"string"!=typeof e.body._id&&(e.body._id=""),e.cleanData={Username:s(e.body.Username.trim(),{allowedTags:[],allowedAttributes:{}}),Pass:s(e.body.Pass.trim(),{allowedTags:[],allowedAttributes:{}}),Team:s(e.body.Team.trim(),{allowedTags:[],allowedAttributes:{}}),Role:s(e.body.Role.trim(),{allowedTags:[],allowedAttributes:{}})},a()}o.ensureDirSync(i.join("public","upload-img")),u.set("view engine","ejs"),u.set("views","./views"),u.use(e.static("public")),u.use(e.json()),u.use(e.urlencoded({extended:!1})),u.get("/",(async(e,t)=>{const a=await p.collection("User").find().toArray(),n=d.renderToString(c.createElement("div",{className:"container"},c.createElement("div",{className:"user-grid"},a.map((e=>c.createElement(m,{key:e._id,name:e.Username,Role:e.Role,photo:e.photo,id:e._id,readOnly:!0}))))));t.render("home",{generateHTML:n})})),u.use((function(e,t,a){const n=e.headers.authorization;if(n){const e=n.split(" ")[1],r=Buffer.from(e,"base64").toString("utf-8"),[s,o]=r.split(":");p.collection("User").findOne({Username:s,Pass:o}).then((e=>{e&&"Admin"==e.Role?a():(console.log(n),t.status(401).send("Try again"))})).catch((e=>{console.log(e),t.status(500).send("Internal Server Error")}))}else t.set("WWW-Authenticate","Basic realm='MERN'"),t.status(401).send("Authorization required")})),u.delete("/user/:id",(async(e,t)=>{"string"!=typeof e.params.id&&(e.params.id="");const a=await p.collection("User").findOne({_id:new n(e.params.id)});a.photo&&o.remove(i.join("public","upload-img",a.photo)),p.collection("User").deleteOne({_id:new n(e.params.id)}),t.send("Deleted")})),u.post("/update-user",f.single("photo"),g,(async(e,t)=>{if(e.file){const a=`${Date.now()}.jpg`;await l(e.file.buffer).resize(170,170).jpeg({quality:60}).toFile(i.join("public","upload-img",a)),e.cleanData.photo=a;const r=await p.collection("User").findOneAndUpdate({_id:new n(e.body._id)},{$set:e.cleanData});r.value.photo&&o.remove(i.join("public","upload-img",r.value.photo)),t.send(a)}else p.collection("User").findOneAndUpdate({_id:new n(e.body._id)},{$set:e.cleanData}),t.send(!1)})),u.get("/api/users",(async(e,t)=>{const a=await p.collection("User").find().toArray();t.json(a)})),u.post("/create-user",f.single("photo"),g,(async(e,t)=>{if(await p.collection("User").findOne({Username:e.cleanData.Username}))return t.status(400).send("Username already exists");{if(e.file){const t=`${Date.now()}.jpg`;await l(e.file.buffer).resize(170,170).jpeg({quality:60}).toFile(i.join("public","upload-img",t)),e.cleanData.photo=t}console.log(e.body);const a=await p.collection("User").insertOne(e.cleanData),r=await p.collection("User").findOne({_id:new n(a.insertedId)});t.send(r)}})),u.get("/admin",((e,t)=>{t.render("admin")})),async function(){const e=new t("mongodb://admin:admin@localhost:27017/Mern?&authSource=admin");await e.connect(),p=e.db(),u.listen(3e3)}()})()})();